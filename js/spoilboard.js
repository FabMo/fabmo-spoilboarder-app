// Paths (0 at origin)
var pocket = [{"y": 0.3148, "x": 0.0028}, {"y": 0.3146, "x": 0.0054}, {"y": 0.3143, "x": 0.0079}, {"y": 0.3139, "x": 0.0101}, {"y": 0.3133, "x": 0.0126}, {"y": 0.3128, "x": 0.0143}, {"y": 0.3121, "x": 0.0165}, {"y": 0.3112, "x": 0.0189}, {"y": 0.3104, "x": 0.0206}, {"y": 0.3092, "x": 0.0228}, {"y": 0.308, "x": 0.0249}, {"y": 0.307, "x": 0.0265}, {"y": 0.3054, "x": 0.0288}, {"y": 0.3039, "x": 0.0306}, {"y": 0.3025, "x": 0.0323}, {"y": 0.3008, "x": 0.0341}, {"y": 0.2989, "x": 0.0359}, {"y": 0.2973, "x": 0.0373}, {"y": 0.2954, "x": 0.0388}, {"y": 0.2935, "x": 0.0402}, {"y": 0.2916, "x": 0.0413}, {"y": 0.2892, "x": 0.0427}, {"y": 0.2875, "x": 0.0436}, {"y": 0.2853, "x": 0.0446}, {"y": 0.2835, "x": 0.0453}, {"y": 0.281, "x": 0.0462}, {"y": 0.2791, "x": 0.0467}, {"y": 0.2768, "x": 0.0472}, {"y": 0.2747, "x": 0.0476}, {"y": 0.2719, "x": 0.048}, {"y": 0.2696, "x": 0.0481}, {"y": 0.2623, "x": 0.0483}, {"y": -0.2623, "x": 0.0483}, {"y": -0.2696, "x": 0.0481}, {"y": -0.2719, "x": 0.048}, {"y": -0.2744, "x": 0.0477}, {"y": -0.2767, "x": 0.0473}, {"y": -0.2791, "x": 0.0467}, {"y": -0.2809, "x": 0.0462}, {"y": -0.2835, "x": 0.0453}, {"y": -0.2853, "x": 0.0446}, {"y": -0.2875, "x": 0.0436}, {"y": -0.2892, "x": 0.0427}, {"y": -0.2916, "x": 0.0414}, {"y": -0.2935, "x": 0.0402}, {"y": -0.2954, "x": 0.0388}, {"y": -0.2972, "x": 0.0374}, {"y": -0.299, "x": 0.0359}, {"y": -0.3008, "x": 0.0341}, {"y": -0.3025, "x": 0.0323}, {"y": -0.304, "x": 0.0306}, {"y": -0.3054, "x": 0.0288}, {"y": -0.307, "x": 0.0265}, {"y": -0.308, "x": 0.0249}, {"y": -0.3092, "x": 0.0228}, {"y": -0.3104, "x": 0.0206}, {"y": -0.3112, "x": 0.0189}, {"y": -0.3121, "x": 0.0165}, {"y": -0.3129, "x": 0.0143}, {"y": -0.3133, "x": 0.0126}, {"y": -0.3139, "x": 0.0101}, {"y": -0.3143, "x": 0.0079}, {"y": -0.3146, "x": 0.0054}, {"y": -0.3148, "x": 0.0028}, {"y": -0.3149, "x": 0.0}, {"y": -0.3148, "x": -0.0028}, {"y": -0.3146, "x": -0.0052}, {"y": -0.3143, "x": -0.008}, {"y": -0.3139, "x": -0.0101}, {"y": -0.3133, "x": -0.0126}, {"y": -0.3128, "x": -0.0143}, {"y": -0.3121, "x": -0.0165}, {"y": -0.3112, "x": -0.0189}, {"y": -0.3104, "x": -0.0206}, {"y": -0.3093, "x": -0.0227}, {"y": -0.308, "x": -0.025}, {"y": -0.3068, "x": -0.0268}, {"y": -0.3054, "x": -0.0288}, {"y": -0.304, "x": -0.0306}, {"y": -0.3025, "x": -0.0323}, {"y": -0.3008, "x": -0.0341}, {"y": -0.299, "x": -0.0358}, {"y": -0.2972, "x": -0.0374}, {"y": -0.2954, "x": -0.0388}, {"y": -0.2934, "x": -0.0402}, {"y": -0.2916, "x": -0.0413}, {"y": -0.2894, "x": -0.0426}, {"y": -0.2872, "x": -0.0438}, {"y": -0.2855, "x": -0.0445}, {"y": -0.2831, "x": -0.0454}, {"y": -0.281, "x": -0.0462}, {"y": -0.2792, "x": -0.0467}, {"y": -0.2767, "x": -0.0473}, {"y": -0.2745, "x": -0.0476}, {"y": -0.2719, "x": -0.048}, {"y": -0.2695, "x": -0.0481}, {"y": -0.2623, "x": -0.0483}, {"y": 0.2623, "x": -0.0483}, {"y": 0.2695, "x": -0.0481}, {"y": 0.2721, "x": -0.0479}, {"y": 0.2747, "x": -0.0476}, {"y": 0.2765, "x": -0.0473}, {"y": 0.2793, "x": -0.0466}, {"y": 0.281, "x": -0.0462}, {"y": 0.2831, "x": -0.0454}, {"y": 0.2855, "x": -0.0445}, {"y": 0.2872, "x": -0.0437}, {"y": 0.2894, "x": -0.0426}, {"y": 0.2916, "x": -0.0413}, {"y": 0.2934, "x": -0.0402}, {"y": 0.2954, "x": -0.0388}, {"y": 0.2973, "x": -0.0373}, {"y": 0.299, "x": -0.0358}, {"y": 0.3008, "x": -0.0341}, {"y": 0.3025, "x": -0.0323}, {"y": 0.304, "x": -0.0306}, {"y": 0.3054, "x": -0.0288}, {"y": 0.3069, "x": -0.0268}, {"y": 0.308, "x": -0.025}, {"y": 0.3093, "x": -0.0227}, {"y": 0.3104, "x": -0.0206}, {"y": 0.3112, "x": -0.0189}, {"y": 0.3121, "x": -0.0165}, {"y": 0.3128, "x": -0.0143}, {"y": 0.3133, "x": -0.0126}, {"y": 0.3139, "x": -0.0101}, {"y": 0.3143, "x": -0.008}, {"y": 0.3146, "x": -0.0052}, {"y": 0.3148, "x": -0.0028}, {"y": 0.3149, "x": 0.0}, {"y": 0.3148, "x": 0.0028}, {"y": 0.4147, "x": 0.0079}, {"y": 0.4142, "x": 0.0153}, {"y": 0.4132, "x": 0.023}, {"y": 0.4119, "x": 0.03}, {"y": 0.4102, "x": 0.0375}, {"y": 0.4083, "x": 0.044}, {"y": 0.406, "x": 0.051}, {"y": 0.4033, "x": 0.0577}, {"y": 0.4005, "x": 0.0641}, {"y": 0.3972, "x": 0.0705}, {"y": 0.3935, "x": 0.0769}, {"y": 0.3899, "x": 0.0826}, {"y": 0.3856, "x": 0.0886}, {"y": 0.3811, "x": 0.0943}, {"y": 0.3766, "x": 0.0995}, {"y": 0.3715, "x": 0.1049}, {"y": 0.3662, "x": 0.1099}, {"y": 0.3608, "x": 0.1146}, {"y": 0.3554, "x": 0.1188}, {"y": 0.3495, "x": 0.123}, {"y": 0.3434, "x": 0.1269}, {"y": 0.337, "x": 0.1306}, {"y": 0.3309, "x": 0.1337}, {"y": 0.3244, "x": 0.1367}, {"y": 0.3178, "x": 0.1393}, {"y": 0.3107, "x": 0.1417}, {"y": 0.3041, "x": 0.1436}, {"y": 0.2967, "x": 0.1453}, {"y": 0.2895, "x": 0.1465}, {"y": 0.2819, "x": 0.1475}, {"y": 0.2747, "x": 0.1481}, {"y": 0.2637, "x": 0.1483}, {"y": -0.2637, "x": 0.1483}, {"y": -0.2747, "x": 0.1481}, {"y": -0.282, "x": 0.1475}, {"y": -0.2895, "x": 0.1465}, {"y": -0.2967, "x": 0.1453}, {"y": -0.3041, "x": 0.1436}, {"y": -0.3107, "x": 0.1417}, {"y": -0.3178, "x": 0.1393}, {"y": -0.3244, "x": 0.1367}, {"y": -0.3309, "x": 0.1337}, {"y": -0.337, "x": 0.1306}, {"y": -0.3435, "x": 0.1269}, {"y": -0.3495, "x": 0.123}, {"y": -0.3554, "x": 0.1188}, {"y": -0.3608, "x": 0.1146}, {"y": -0.3662, "x": 0.1099}, {"y": -0.3715, "x": 0.1049}, {"y": -0.3766, "x": 0.0995}, {"y": -0.3811, "x": 0.0943}, {"y": -0.3856, "x": 0.0886}, {"y": -0.3899, "x": 0.0826}, {"y": -0.3935, "x": 0.0769}, {"y": -0.3972, "x": 0.0705}, {"y": -0.4005, "x": 0.0641}, {"y": -0.4033, "x": 0.0577}, {"y": -0.406, "x": 0.051}, {"y": -0.4084, "x": 0.044}, {"y": -0.4102, "x": 0.0375}, {"y": -0.4119, "x": 0.03}, {"y": -0.4132, "x": 0.023}, {"y": -0.4142, "x": 0.0153}, {"y": -0.4147, "x": 0.0079}, {"y": -0.4149, "x": -0.0}, {"y": -0.4147, "x": -0.0079}, {"y": -0.4142, "x": -0.0153}, {"y": -0.4132, "x": -0.0231}, {"y": -0.4119, "x": -0.03}, {"y": -0.4102, "x": -0.0374}, {"y": -0.4083, "x": -0.0441}, {"y": -0.406, "x": -0.051}, {"y": -0.4033, "x": -0.0577}, {"y": -0.4005, "x": -0.0641}, {"y": -0.3972, "x": -0.0705}, {"y": -0.3936, "x": -0.0767}, {"y": -0.3897, "x": -0.0829}, {"y": -0.3855, "x": -0.0887}, {"y": -0.3813, "x": -0.0941}, {"y": -0.3765, "x": -0.0996}, {"y": -0.3715, "x": -0.1048}, {"y": -0.3662, "x": -0.1099}, {"y": -0.3608, "x": -0.1146}, {"y": -0.3554, "x": -0.1188}, {"y": -0.3495, "x": -0.123}, {"y": -0.3434, "x": -0.1269}, {"y": -0.3372, "x": -0.1305}, {"y": -0.3307, "x": -0.1338}, {"y": -0.3244, "x": -0.1367}, {"y": -0.3177, "x": -0.1393}, {"y": -0.3108, "x": -0.1417}, {"y": -0.3041, "x": -0.1436}, {"y": -0.2967, "x": -0.1453}, {"y": -0.2898, "x": -0.1465}, {"y": -0.282, "x": -0.1475}, {"y": -0.2745, "x": -0.1481}, {"y": -0.2637, "x": -0.1483}, {"y": 0.2637, "x": -0.1483}, {"y": 0.2745, "x": -0.1481}, {"y": 0.2821, "x": -0.1475}, {"y": 0.2898, "x": -0.1465}, {"y": 0.2967, "x": -0.1453}, {"y": 0.3041, "x": -0.1436}, {"y": 0.3107, "x": -0.1417}, {"y": 0.3176, "x": -0.1393}, {"y": 0.3244, "x": -0.1367}, {"y": 0.3307, "x": -0.1338}, {"y": 0.3372, "x": -0.1305}, {"y": 0.3434, "x": -0.1269}, {"y": 0.3495, "x": -0.123}, {"y": 0.3554, "x": -0.1188}, {"y": 0.3608, "x": -0.1146}, {"y": 0.3662, "x": -0.1099}, {"y": 0.3715, "x": -0.1048}, {"y": 0.3765, "x": -0.0996}, {"y": 0.3813, "x": -0.0941}, {"y": 0.3855, "x": -0.0887}, {"y": 0.3897, "x": -0.0829}, {"y": 0.3936, "x": -0.0767}, {"y": 0.3972, "x": -0.0705}, {"y": 0.4005, "x": -0.0641}, {"y": 0.4033, "x": -0.0577}, {"y": 0.406, "x": -0.051}, {"y": 0.4083, "x": -0.0441}, {"y": 0.4102, "x": -0.0374}, {"y": 0.4119, "x": -0.03}, {"y": 0.4132, "x": -0.0231}, {"y": 0.4142, "x": -0.0153}, {"y": 0.4147, "x": -0.0079}, {"y": 0.4149, "x": -0.0}, {"y": 0.4147, "x": 0.0079}, {"y": 0.5146, "x": 0.0129}, {"y": 0.5137, "x": 0.0255}, {"y": 0.5121, "x": 0.038}, {"y": 0.5099, "x": 0.0502}, {"y": 0.5071, "x": 0.0623}, {"y": 0.5039, "x": 0.0737}, {"y": 0.4999, "x": 0.0854}, {"y": 0.4955, "x": 0.0966}, {"y": 0.4906, "x": 0.1075}, {"y": 0.4851, "x": 0.1182}, {"y": 0.4791, "x": 0.1287}, {"y": 0.4727, "x": 0.1387}, {"y": 0.4657, "x": 0.1485}, {"y": 0.4583, "x": 0.1579}, {"y": 0.4505, "x": 0.167}, {"y": 0.4423, "x": 0.1755}, {"y": 0.4335, "x": 0.1839}, {"y": 0.4245, "x": 0.1917}, {"y": 0.4153, "x": 0.199}, {"y": 0.4054, "x": 0.206}, {"y": 0.3954, "x": 0.2124}, {"y": 0.3848, "x": 0.2184}, {"y": 0.3742, "x": 0.2239}, {"y": 0.3633, "x": 0.2288}, {"y": 0.3522, "x": 0.2332}, {"y": 0.3404, "x": 0.2372}, {"y": 0.329, "x": 0.2404}, {"y": 0.3168, "x": 0.2432}, {"y": 0.3046, "x": 0.2454}, {"y": 0.2921, "x": 0.247}, {"y": 0.2796, "x": 0.248}, {"y": 0.2651, "x": 0.2483}, {"y": -0.2651, "x": 0.2483}, {"y": -0.2796, "x": 0.248}, {"y": -0.2921, "x": 0.247}, {"y": -0.3046, "x": 0.2454}, {"y": -0.3168, "x": 0.2432}, {"y": -0.329, "x": 0.2404}, {"y": -0.3404, "x": 0.2372}, {"y": -0.3522, "x": 0.2332}, {"y": -0.3632, "x": 0.2288}, {"y": -0.3743, "x": 0.2239}, {"y": -0.3849, "x": 0.2184}, {"y": -0.3954, "x": 0.2124}, {"y": -0.4054, "x": 0.206}, {"y": -0.4153, "x": 0.199}, {"y": -0.4245, "x": 0.1917}, {"y": -0.4335, "x": 0.1839}, {"y": -0.4423, "x": 0.1755}, {"y": -0.4505, "x": 0.167}, {"y": -0.4583, "x": 0.1579}, {"y": -0.4657, "x": 0.1485}, {"y": -0.4727, "x": 0.1387}, {"y": -0.4791, "x": 0.1287}, {"y": -0.4851, "x": 0.1182}, {"y": -0.4906, "x": 0.1075}, {"y": -0.4955, "x": 0.0966}, {"y": -0.4999, "x": 0.0854}, {"y": -0.5039, "x": 0.0737}, {"y": -0.5071, "x": 0.0623}, {"y": -0.5099, "x": 0.0502}, {"y": -0.5121, "x": 0.038}, {"y": -0.5137, "x": 0.0255}, {"y": -0.5146, "x": 0.0129}, {"y": -0.515, "x": -0.0}, {"y": -0.5146, "x": -0.0129}, {"y": -0.5137, "x": -0.0255}, {"y": -0.5121, "x": -0.038}, {"y": -0.5099, "x": -0.0502}, {"y": -0.5071, "x": -0.0623}, {"y": -0.5039, "x": -0.0737}, {"y": -0.4999, "x": -0.0854}, {"y": -0.4955, "x": -0.0966}, {"y": -0.4906, "x": -0.1075}, {"y": -0.4851, "x": -0.1182}, {"y": -0.4791, "x": -0.1287}, {"y": -0.4726, "x": -0.1387}, {"y": -0.4656, "x": -0.1486}, {"y": -0.4584, "x": -0.1579}, {"y": -0.4506, "x": -0.1668}, {"y": -0.4422, "x": -0.1756}, {"y": -0.4335, "x": -0.1839}, {"y": -0.4245, "x": -0.1917}, {"y": -0.4153, "x": -0.199}, {"y": -0.4054, "x": -0.206}, {"y": -0.3954, "x": -0.2124}, {"y": -0.3849, "x": -0.2184}, {"y": -0.3742, "x": -0.2239}, {"y": -0.3633, "x": -0.2288}, {"y": -0.3521, "x": -0.2332}, {"y": -0.3404, "x": -0.2372}, {"y": -0.329, "x": -0.2404}, {"y": -0.3168, "x": -0.2433}, {"y": -0.3047, "x": -0.2454}, {"y": -0.2922, "x": -0.247}, {"y": -0.2796, "x": -0.248}, {"y": -0.2651, "x": -0.2483}, {"y": 0.2651, "x": -0.2483}, {"y": 0.2796, "x": -0.248}, {"y": 0.2921, "x": -0.247}, {"y": 0.3048, "x": -0.2454}, {"y": 0.3168, "x": -0.2433}, {"y": 0.329, "x": -0.2404}, {"y": 0.3404, "x": -0.2372}, {"y": 0.3521, "x": -0.2332}, {"y": 0.3633, "x": -0.2288}, {"y": 0.3742, "x": -0.2239}, {"y": 0.3849, "x": -0.2184}, {"y": 0.3954, "x": -0.2124}, {"y": 0.4054, "x": -0.206}, {"y": 0.4153, "x": -0.199}, {"y": 0.4245, "x": -0.1917}, {"y": 0.4335, "x": -0.1839}, {"y": 0.4422, "x": -0.1756}, {"y": 0.4506, "x": -0.1668}, {"y": 0.4584, "x": -0.1579}, {"y": 0.4656, "x": -0.1486}, {"y": 0.4726, "x": -0.1387}, {"y": 0.4791, "x": -0.1287}, {"y": 0.4851, "x": -0.1182}, {"y": 0.4906, "x": -0.1075}, {"y": 0.4955, "x": -0.0966}, {"y": 0.4999, "x": -0.0854}, {"y": 0.5039, "x": -0.0737}, {"y": 0.5071, "x": -0.0623}, {"y": 0.5099, "x": -0.0502}, {"y": 0.5121, "x": -0.038}, {"y": 0.5137, "x": -0.0255}, {"y": 0.5146, "x": -0.0129}, {"y": 0.515, "x": -0.0}, {"y": 0.5146, "x": 0.0129}]
var slot = [{"y": 0.2747, "x": 0.0021}, {"y": 0.2744, "x": 0.004}, {"y": 0.274, "x": 0.0057}, {"y": 0.2734, "x": 0.0073}, {"y": 0.2726, "x": 0.0089}, {"y": 0.2717, "x": 0.0105}, {"y": 0.2706, "x": 0.012}, {"y": 0.2693, "x": 0.0133}, {"y": 0.268, "x": 0.0146}, {"y": 0.2665, "x": 0.0157}, {"y": 0.2649, "x": 0.0166}, {"y": 0.2634, "x": 0.0174}, {"y": 0.2617, "x": 0.018}, {"y": 0.2599, "x": 0.0184}, {"y": 0.2581, "x": 0.0187}, {"y": 0.2528, "x": 0.019}, {"y": -0.2528, "x": 0.019}, {"y": -0.2581, "x": 0.0187}, {"y": -0.2599, "x": 0.0184}, {"y": -0.2617, "x": 0.018}, {"y": -0.2634, "x": 0.0174}, {"y": -0.2649, "x": 0.0166}, {"y": -0.2665, "x": 0.0157}, {"y": -0.268, "x": 0.0146}, {"y": -0.2693, "x": 0.0133}, {"y": -0.2706, "x": 0.012}, {"y": -0.2717, "x": 0.0105}, {"y": -0.2726, "x": 0.0089}, {"y": -0.2734, "x": 0.0073}, {"y": -0.274, "x": 0.0057}, {"y": -0.2745, "x": 0.004}, {"y": -0.2747, "x": 0.0021}, {"y": -0.2748, "x": -0.0001}, {"y": -0.2747, "x": -0.0021}, {"y": -0.2745, "x": -0.0039}, {"y": -0.274, "x": -0.0057}, {"y": -0.2734, "x": -0.0073}, {"y": -0.2726, "x": -0.0089}, {"y": -0.2717, "x": -0.0105}, {"y": -0.2706, "x": -0.0119}, {"y": -0.2693, "x": -0.0133}, {"y": -0.2679, "x": -0.0146}, {"y": -0.2665, "x": -0.0157}, {"y": -0.2649, "x": -0.0166}, {"y": -0.2633, "x": -0.0174}, {"y": -0.2617, "x": -0.018}, {"y": -0.26, "x": -0.0184}, {"y": -0.2581, "x": -0.0187}, {"y": -0.2529, "x": -0.019}, {"y": 0.2529, "x": -0.019}, {"y": 0.2581, "x": -0.0187}, {"y": 0.26, "x": -0.0184}, {"y": 0.2617, "x": -0.018}, {"y": 0.2633, "x": -0.0174}, {"y": 0.2649, "x": -0.0166}, {"y": 0.2665, "x": -0.0157}, {"y": 0.2679, "x": -0.0146}, {"y": 0.2693, "x": -0.0133}, {"y": 0.2706, "x": -0.0119}, {"y": 0.2717, "x": -0.0105}, {"y": 0.2726, "x": -0.0089}, {"y": 0.2734, "x": -0.0073}, {"y": 0.274, "x": -0.0057}, {"y": 0.2745, "x": -0.0039}, {"y": 0.2747, "x": -0.0021}, {"y": 0.2748, "x": -0.0001}, {"y": 0.2747, "x": 0.0021}]
var DIG = 4;
var loc_index = {
	"SB Desktop" : [{x:0,y:0},{x:10.25,y:2.75},{x:20.5,y:0},{x:17.5,y:7.25},{x:3,y:7.25}, {x:10.25, y:10.0}, {x:0,y:15}, {x:20.5,y:15}]
}

function getLocations(name) {
	return loc_index[name] || [];
}

function offset(path, xoffset, yoffset) {
	retval = [];
	for(i in path) {
		point = path[i];
		var newx = point.x + xoffset;
		var newy = point.y + yoffset;
		retval.push({
			'x' : newx,
			'y' : newy
		});
	}
	return retval
}

function makeGCodeFromPath(path, feedrate) {
	retval = [];
	for(i in path) {
		point = path[i];
		retval.push('G1 X' + point.x.toFixed(DIG) + ' Y' + point.y.toFixed(DIG) + ' F' + feedrate);
	}
	return retval.join('\n');
}

function generateGCode(locations, options) {
	pocketDepth = options.pocketDepth || 0.25; 	// inches
	slotDepth = options.slotDepth || 0.75; 		// inches
	passDepth = options.passDepth || 0.125;		// inches
	safeZ = options.safeZ || 0.5; 				// inches
	cutRate = options.cutRate || 90.0; 			// ipm
	plungeRate = options.plungeRate || cutRate	// ipm

	var retval = []

	// Absolute, inches
	retval.push('G20', 'G90');

	// Pull up
	retval.push('G0 Z' + safeZ.toFixed(DIG));
	
	// Turn on cutter and wait for spin-up
	retval.push('M4', 'G4 P3.0');

	for(i in locations) {
		loc = locations[i];
		var pocket_path = offset(pocket, loc.x, loc.y);
		var slot_path = offset(slot, loc.x, loc.y);

		retval.push('(Pocket @ ' + loc.x.toFixed(DIG) + ',' + loc.y.toFixed(DIG) + ')');
		// Move to start of pocket
		retval.push('G0 X' + pocket_path[0].x.toFixed(DIG) + ' Y' + pocket_path[0].y.toFixed(DIG));
		
		zDepth = passDepth;
		while(zDepth < pocketDepth) {
			if(zDepth > pocketDepth) { zDepth = pocketDepth; }
			// Plunge
			retval.push('G1 Z' + -zDepth.toFixed(DIG) + ' F' + plungeRate);
			// Cut pocket
			retval.push(makeGCodeFromPath(pocket_path, cutRate));
			zDepth += passDepth;
		}
	
		// Pull up
		retval.push('G0 Z' + (-pocketDepth + safeZ).toFixed(DIG));

		// Move to start of slot
		retval.push('(Slot @ ' + loc.x.toFixed(DIG) + ',' + loc.y.toFixed(DIG) + ')');
		retval.push('G0 X' + slot_path[0].x.toFixed(DIG) + ' Y' + slot_path[0].y.toFixed(DIG));

		zDepth = pocketDepth + passDepth
		while(zDepth < slotDepth) {
			if(zDepth > slotDepth) { zDepth = slotDepth; }
			// Plunge
			retval.push('G1 Z' + -zDepth.toFixed(DIG) + ' F' + plungeRate);
			// Cut slot
			retval.push(makeGCodeFromPath(slot_path, cutRate));
			zDepth += passDepth;
		}

		// Pull up before next move
		retval.push('G0 Z' + safeZ.toFixed(DIG));

	}
	retval.push('G0 X0 Y0')

	return retval.join('\n');
}